# BioinfoFlow Specification v0.1 🧬

## Table of Contents
- [Overview](#overview) 📋
- [Key Features](#key-features) ⭐
- [Core Concepts](#core-concepts) 💡
- [File Format](#file-format) 📄
- [Configuration Reference](#configuration-reference) ⚙️
- [Examples](#examples) 🌟
- [Best Practices](#best-practices) 🎯
- [Experimental Features](#experimental-features) 🧪
- [Style Guide](#style-guide) 📝
- [Version Control](#version-control) 🔄

## Overview 📋

BioinfoFlow is a powerful workflow engine specifically designed for bioinformatics applications. This specification defines a human-readable, container-native workflow language that emphasizes reproducibility, scalability, and ease of use.

## Key Features ⭐

- 🐳 Container-native execution with automatic version management
- 📊 Flexible resource management
- 💾 Built-in checkpoint and resume capability
- 🔍 Dynamic input pattern matching
- ⚡ Parallel and sequential execution support
- 🔗 Clear dependency management
- 🛡️ Environment isolation

## Core Concepts 💡

### Workflows
A workflow is a collection of steps that process data. Each step represents a discrete unit of work.

### Steps
Steps are the basic building blocks of a workflow. They can be:
- Single tasks
- Parallel groups
- Sequential groups

### Dependencies
Steps can depend on other steps, forming a directed acyclic graph (DAG).

### Containers
Each step runs in its own container environment, ensuring reproducibility.

## File Format 📄

Workflows are defined in YAML format. Here's the basic structure:

```yaml
name: my_workflow           # Simple identifier, no quotes needed
version: "1.0.0"           # Version number, quotes required
description: A simple workflow for DNA analysis

inputs:
  fastq_files:
    type: file
    pattern: "*.fastq.gz"  # Pattern with special chars, quotes required
    
steps:
  fastqc:
    container: "biocontainers/fastqc:v0.11.9"  # Image reference, quotes required
    command: "fastqc ${inputs.fastq_files}"     # Command with vars, quotes required
    resources:
      cpu: 2               # Numbers, no quotes
      memory: 4G           # Units, no quotes
```

## Configuration Reference ⚙️

### Root Level Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| name | string | Yes | Workflow name |
| version | string | Yes | Workflow version |
| description | string | No | Workflow description |
| inputs | object | No | Global inputs |
| steps | object | Yes | Workflow steps |
| resources | object | No | Resource defaults |

### Step Configuration

```yaml
steps:
  step_name:
    container: "image:tag"        # Container image
    command: "echo hello"         # Command to run
    after: [step1, step2]        # Dependencies
    parallel: true               # Parallel execution flag
    resources:
      cpu: 2
      memory: 4G
    volumes:
      - "/host:/container"       # Volume mounts
```

### Resource Configuration

```yaml
resources:
    cpu: 1
    memory: 4G
    gpu: 0
```

## Examples 🌟

### Simple DNA-seq Pipeline

```yaml
name: dna_seq_pipeline
version: "1.0.0"

inputs:
  reads:
    type: file
    pattern: "*.fastq.gz"

steps:
  fastqc:
    container: "biocontainers/fastqc:v0.11.9"
    command: "fastqc ${inputs.reads}"
    resources:
      cpu: 2
      memory: 4G

  bwa_mem:
    container: "biocontainers/bwa:v0.7.17"
    command: "bwa mem -t ${resources.cpu} ref.fa ${inputs.reads}"
    after: [fastqc]
    resources:
      cpu: 8
      memory: 16G
```

## Best Practices 🎯

### Container Usage 🐳
- Use specific version tags
- Minimize image size
- Use official or verified images

### Resource Management 📊
- Set appropriate resource limits
- Use resource profiles for different environments
- Monitor resource usage

### Workflow Design 📐
- Keep steps modular
- Use meaningful names
- Document inputs and outputs

### Error Handling ⚠️
- Implement proper error checking
- Use appropriate retry strategies
- Log errors effectively

## Experimental Features 🧪

### Metadata
```yaml
metadata:
  author: name
  tags: [DNA-seq, RNA-seq]
  license: MIT
  documentation: "https://docs.example.com"
```

### Conditions
```yaml
conditions:
  file_exists:
    when: "exists:/path/to/file"
    skip: false
```

### Hooks
```yaml
hooks:
  before_step:
    - "check_resources"
  after_step:
    - "cleanup"
```

## Style Guide 📝

### Quoting Rules

Use quotes for:
- 📍 File paths: `"path/to/file"`
- 📌 Version numbers: `"1.0.0"`
- 🔤 Strings with special characters
- 💻 Commands with variables
- 🐳 Container references

Don't use quotes for:
- 📛 Simple identifiers
- 🔢 Numbers
- ⚡ Resource units
- ✅ Boolean values

## Version Control 🔄

This specification is version 0.1. Future versions may include:
- 🔄 Advanced container orchestration
- 🔗 Enhanced dependency management
- 🛡️ Extended security features
- 📊 Advanced monitoring capabilities 